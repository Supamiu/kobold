// Stolen and ported to JS from https://github.com/NotAdam/Lumina/blob/master/Lumina/Misc/Crc32.cs

export function crc(input: string | Buffer) {
	const buffer = Buffer.isBuffer(input) ? input : Buffer.from(input)

	let crc = 0xffffffffn

	const size = buffer.length
	for (let i = 0; i < size; i++) {
		let b = BigInt(buffer[i])

		if (b >= 0x41 && b <= 0x5a) {
			b += 0x20n
		}

		const idx = Number((b ^ crc) % 256n)
		crc = (crc >> 8n) ^ table[idx]
	}

	return crc
}

// prettier-ignore
const table = [
	0x00000000n, 0x77073096n, 0xEE0E612Cn, 0x990951BAn, 0x076DC419n, 0x706AF48Fn, 0xE963A535n, 0x9E6495A3n,
	0x0EDB8832n, 0x79DCB8A4n, 0xE0D5E91En, 0x97D2D988n, 0x09B64C2Bn, 0x7EB17CBDn, 0xE7B82D07n, 0x90BF1D91n,
	0x1DB71064n, 0x6AB020F2n, 0xF3B97148n, 0x84BE41DEn, 0x1ADAD47Dn, 0x6DDDE4EBn, 0xF4D4B551n, 0x83D385C7n,
	0x136C9856n, 0x646BA8C0n, 0xFD62F97An, 0x8A65C9ECn, 0x14015C4Fn, 0x63066CD9n, 0xFA0F3D63n, 0x8D080DF5n,
	0x3B6E20C8n, 0x4C69105En, 0xD56041E4n, 0xA2677172n, 0x3C03E4D1n, 0x4B04D447n, 0xD20D85FDn, 0xA50AB56Bn,
	0x35B5A8FAn, 0x42B2986Cn, 0xDBBBC9D6n, 0xACBCF940n, 0x32D86CE3n, 0x45DF5C75n, 0xDCD60DCFn, 0xABD13D59n,
	0x26D930ACn, 0x51DE003An, 0xC8D75180n, 0xBFD06116n, 0x21B4F4B5n, 0x56B3C423n, 0xCFBA9599n, 0xB8BDA50Fn,
	0x2802B89En, 0x5F058808n, 0xC60CD9B2n, 0xB10BE924n, 0x2F6F7C87n, 0x58684C11n, 0xC1611DABn, 0xB6662D3Dn,
	0x76DC4190n, 0x01DB7106n, 0x98D220BCn, 0xEFD5102An, 0x71B18589n, 0x06B6B51Fn, 0x9FBFE4A5n, 0xE8B8D433n,
	0x7807C9A2n, 0x0F00F934n, 0x9609A88En, 0xE10E9818n, 0x7F6A0DBBn, 0x086D3D2Dn, 0x91646C97n, 0xE6635C01n,
	0x6B6B51F4n, 0x1C6C6162n, 0x856530D8n, 0xF262004En, 0x6C0695EDn, 0x1B01A57Bn, 0x8208F4C1n, 0xF50FC457n,
	0x65B0D9C6n, 0x12B7E950n, 0x8BBEB8EAn, 0xFCB9887Cn, 0x62DD1DDFn, 0x15DA2D49n, 0x8CD37CF3n, 0xFBD44C65n,
	0x4DB26158n, 0x3AB551CEn, 0xA3BC0074n, 0xD4BB30E2n, 0x4ADFA541n, 0x3DD895D7n, 0xA4D1C46Dn, 0xD3D6F4FBn,
	0x4369E96An, 0x346ED9FCn, 0xAD678846n, 0xDA60B8D0n, 0x44042D73n, 0x33031DE5n, 0xAA0A4C5Fn, 0xDD0D7CC9n,
	0x5005713Cn, 0x270241AAn, 0xBE0B1010n, 0xC90C2086n, 0x5768B525n, 0x206F85B3n, 0xB966D409n, 0xCE61E49Fn,
	0x5EDEF90En, 0x29D9C998n, 0xB0D09822n, 0xC7D7A8B4n, 0x59B33D17n, 0x2EB40D81n, 0xB7BD5C3Bn, 0xC0BA6CADn,
	0xEDB88320n, 0x9ABFB3B6n, 0x03B6E20Cn, 0x74B1D29An, 0xEAD54739n, 0x9DD277AFn, 0x04DB2615n, 0x73DC1683n,
	0xE3630B12n, 0x94643B84n, 0x0D6D6A3En, 0x7A6A5AA8n, 0xE40ECF0Bn, 0x9309FF9Dn, 0x0A00AE27n, 0x7D079EB1n,
	0xF00F9344n, 0x8708A3D2n, 0x1E01F268n, 0x6906C2FEn, 0xF762575Dn, 0x806567CBn, 0x196C3671n, 0x6E6B06E7n,
	0xFED41B76n, 0x89D32BE0n, 0x10DA7A5An, 0x67DD4ACCn, 0xF9B9DF6Fn, 0x8EBEEFF9n, 0x17B7BE43n, 0x60B08ED5n,
	0xD6D6A3E8n, 0xA1D1937En, 0x38D8C2C4n, 0x4FDFF252n, 0xD1BB67F1n, 0xA6BC5767n, 0x3FB506DDn, 0x48B2364Bn,
	0xD80D2BDAn, 0xAF0A1B4Cn, 0x36034AF6n, 0x41047A60n, 0xDF60EFC3n, 0xA867DF55n, 0x316E8EEFn, 0x4669BE79n,
	0xCB61B38Cn, 0xBC66831An, 0x256FD2A0n, 0x5268E236n, 0xCC0C7795n, 0xBB0B4703n, 0x220216B9n, 0x5505262Fn,
	0xC5BA3BBEn, 0xB2BD0B28n, 0x2BB45A92n, 0x5CB36A04n, 0xC2D7FFA7n, 0xB5D0CF31n, 0x2CD99E8Bn, 0x5BDEAE1Dn,
	0x9B64C2B0n, 0xEC63F226n, 0x756AA39Cn, 0x026D930An, 0x9C0906A9n, 0xEB0E363Fn, 0x72076785n, 0x05005713n,
	0x95BF4A82n, 0xE2B87A14n, 0x7BB12BAEn, 0x0CB61B38n, 0x92D28E9Bn, 0xE5D5BE0Dn, 0x7CDCEFB7n, 0x0BDBDF21n,
	0x86D3D2D4n, 0xF1D4E242n, 0x68DDB3F8n, 0x1FDA836En, 0x81BE16CDn, 0xF6B9265Bn, 0x6FB077E1n, 0x18B74777n,
	0x88085AE6n, 0xFF0F6A70n, 0x66063BCAn, 0x11010B5Cn, 0x8F659EFFn, 0xF862AE69n, 0x616BFFD3n, 0x166CCF45n,
	0xA00AE278n, 0xD70DD2EEn, 0x4E048354n, 0x3903B3C2n, 0xA7672661n, 0xD06016F7n, 0x4969474Dn, 0x3E6E77DBn,
	0xAED16A4An, 0xD9D65ADCn, 0x40DF0B66n, 0x37D83BF0n, 0xA9BCAE53n, 0xDEBB9EC5n, 0x47B2CF7Fn, 0x30B5FFE9n,
	0xBDBDF21Cn, 0xCABAC28An, 0x53B39330n, 0x24B4A3A6n, 0xBAD03605n, 0xCDD70693n, 0x54DE5729n, 0x23D967BFn,
	0xB3667A2En, 0xC4614AB8n, 0x5D681B02n, 0x2A6F2B94n, 0xB40BBE37n, 0xC30C8EA1n, 0x5A05DF1Bn, 0x2D02EF8Dn,
]
